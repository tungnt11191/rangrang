<?xml version="1.0"?>
<odoo>
    <data>
        <template id="report_picking_list_request">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <!--div class="header">
                          <div class="text-right">Form No.: SPI123-3  </div>
                        </div-->


                        <div class="page">
                            <div class="row justify-content-end mb16">
                                <div class="col-4" name="right_box">
                                    <!--img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', o.name, 600, 100)" style="width:300px;height:50px;" alt="Barcode"/-->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6" name="div_outgoing_address">
                                    <!--<div t-if="o.move_ids_without_package and o.move_ids_without_package[0].partner_id and o.move_ids_without_package[0].partner_id.id != o.partner_id.id">-->
                                    <!--    <span><strong>Delivery Address:</strong></span>-->
                                    <!--    <div t-field="o.move_ids_without_package[0].partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>-->
                                    <!--</div>-->
                                    <!--<div t-if="o.picking_type_id.code != 'internal' and (not o.move_ids_without_package or not o.move_ids_without_package[0].partner_id) and o.picking_type_id.warehouse_id.partner_id">-->
                                    <!--    <span><strong>Warehouse Address:</strong></span>-->
                                    <!--    <div t-field="o.picking_type_id.warehouse_id.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>-->
                                    <!--</div>-->
                                </div>
                                <div class="col-5 offset-1" name="div_incoming_address">
                                    <!--<div t-if="o.picking_type_id.code=='incoming' and o.partner_id">-->
                                    <!--    <span><strong>Vendor Address:</strong></span>-->
                                    <!--</div>-->
                                    <!--<div t-if="o.picking_type_id.code=='internal' and o.partner_id">-->
                                    <!--    <span><strong>Warehouse Address:</strong></span>-->
                                    <!--</div>-->
                                    <!--<div t-if="o.picking_type_id.code=='outgoing' and o.partner_id">-->
                                    <!--    <span><strong>Customer Address:</strong></span>-->
                                    <!--</div>-->
                                    <!--<div t-if="o.partner_id" name="partner_header">-->
                                    <!--    <div t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>-->
                                    <!--    <p t-if="o.sudo().partner_id.vat"><t t-esc="o.company_id.country_id.vat_label or 'Tax ID'"/>: <span t-field="o.sudo().partner_id.vat"/></p>-->
                                    <!--</div>-->
                                </div>
                            </div>
                            <br/>
                            <h2 class="text-center" >Phiếu yêu cầu hàng hóa</h2>
                            <h2 t-field="o.name" class="text-center"/>
                            <!--h1 t-field="o.name" class="mt0 float-left"/-->
                            <div class="row mt22 mb22">
                                <!--div t-if="o.origin" class="col-auto" name="div_origin">
                                    <strong>Job Order:</strong>
                                    <p t-field="o.origin"/>
                                </div-->
                                <div class="col-3" name="div_state">
                                    <strong>Trạng thái:</strong>
                                    <p t-field="o.state"/>
                                </div>
                                <div class="col-3" name="div_request_date">
                                    <strong>Ngày yêu cầu:</strong>
                                    <p t-esc="context_timestamp(datetime.datetime.now()).strftime('%d-%m-%Y %H:%M')"/>
                                </div>
                                <div class="col-3" name="div_sched_date">
                                    <strong>Ngày yêu cầu giao hàng:</strong>
                                    <p t-field="o.scheduled_date"  t-options='{"format": "d-MM-yyyy HH:MM"}'/>
                                </div>
                                <div class="col-6" name="div_urgent">
                                    <i class="fa fa-square-o"></i> <strong>Ghi chú: </strong><span t-field="o.note"/>
                                </div>

                            </div>
                            <strong>Section: </strong>...................................................................<br/>
                            <strong>Người giao hàng: </strong><span t-field="o.user_id.name"/><br/>
                            <strong>Tài liệu gốc: </strong><span t-field="o.origin"/><br/>
                            <strong>Loại đơn: </strong><span t-field="o.type_order"/><br/>

                                    <!--strong>Finished Product:</strong>
                                    <i class="fa fa-square-o"></i> Urgent
                                    <p t-field="o.x_product_id"/-->

                            <table class="table table-sm" t-if="o.move_line_ids and o.move_ids_without_package">
                                <t t-set="has_barcode" t-value="any([move_ids_without_package.product_id and move_ids_without_package.product_id.sudo().barcode or move_ids_without_package.package_id for move_ids_without_package in o.move_line_ids])"/>
                                <t t-set="has_serial_number" t-value="o.move_line_ids.filtered(lambda ml: ml.lot_id or ml.lot_name)" groups="stock.group_production_lot"/>
                                <thead>
                                    <tr>
                                        <th class="text-center">
                                            <strong>Code</strong>
                                        </th>
                                        <th name="th_product" class="text-center">
                                            <strong>Sản phẩm</strong>
                                        </th>
                                        <!--<th class="text-center">-->
                                        <!--    <strong>L</strong>-->
                                        <!--</th>-->
                                        <!--<th class="text-center">-->
                                        <!--    <strong>W</strong>-->
                                        <!--</th>-->
                                        <!--<th class="text-center">-->
                                        <!--    <strong>H/T</strong>-->
                                        <!--</th>-->
                                        <th class="text-center">
                                            <strong>ĐVT</strong>
                                        </th>
                                        <th class="text-center">
                                            <strong>Số lượng</strong>
                                        </th>
                                        <th class="text-center">
                                            <strong>Đơn bán hàng</strong>
                                        </th>
                                        <th class="text-center">
                                          <strong>SO No.</strong>
                                        </th>

                                        <th name="th_serial_number" class="text-center" t-if="has_serial_number">
                                           <strong>Lot/SN</strong>
                                        </th>
                                        <th name="th_barcode" class="text-center" t-if="has_barcode">
                                            <strong>Barcode</strong>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                  <!--t t-set="i" t-value="1"/-->
                                    <t t-foreach="o.move_ids_without_package.sorted(key=lambda m: m.product_id.id)" t-as="move">
                                        <!-- In case you come accross duplicated lines, ask NIM or LAP -->
                                        <t t-foreach="move.move_line_ids.sorted(key=lambda ml: ml.location_id.id)" t-as="ml">
                                            <tr>
                                          <!--td> <span t-esc="i"/> </td>
                                          <t t-set="i" t-value="i+1"/-->
                                                <td class="text-center">
                                                    <span t-field="ml.product_id.code"/>
                                                </td>
                                                <td class="text-center">
                                                    <span t-field="ml.product_id.name"/>
                                                    <!--span t-field="ml.product_id.display_name"/-->
                                                    <span t-field="ml.product_id.description_picking"/>
                                                </td>
                                                <!--<td class="text-center">-->
                                                <!--    <span t-field="ml.product_id.high"/>-->
                                                <!--</td>-->
                                                <!--<td class="text-center">-->
                                                <!--    <span t-field="ml.product_id.width"/>-->
                                                <!--</td>-->
                                                <!--<td class="text-center">-->
                                                <!--    <span t-field="ml.product_id.onp_ht"/>-->
                                                <!--</td>-->
                                                <td class="text-center">
                                                    <span t-field="ml.product_uom_id" groups="uom.group_uom"/>
                                                </td>

                                                <td class="text-center">
                                                    <span t-if="o.state != 'done'" t-field="ml.product_uom_qty"/>
                                                    <span t-if="o.state == 'done'" t-field="ml.qty_done"/>
                                                    <!--span t-field="ml.product_uom_id" groups="uom.group_uom"/-->
                                                </td>
                                                <td class="text-center">
                                                    <span t-field="o.origin"/>
                                                </td>
                                                <td class="text-center">
                                                  <span t-field="o.origin_source"/>
                                                </td>

                                                <td class=" text-center h6" t-if="has_serial_number">
                                                    <img t-if="has_serial_number and (ml.lot_id or ml.lot_name)" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' % ('Code128', ml.lot_id.name or ml.lot_name, 400, 100)" style="width:100%;height:35px;" alt="Barcode"/>

                                                </td>

                                                <td class="text-center" t-if="has_barcode">
                                                    <t t-if="product_barcode != move.product_id.barcode">
                                                        <span t-if="move.product_id and move.product_id.barcode">
                                                            <img t-if="len(move.product_id.barcode) == 13" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('EAN13', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode"/>
                                                            <img t-elif="len(move.product_id.barcode) == 8" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('EAN8', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode"/>
                                                            <img t-else="" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('Code128', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode"/>

                                                        </span>
                                                        <t t-set="product_barcode" t-value="move.product_id.barcode"/>
                                                    </t>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                  </tbody>
                            </table>
                            <table class="table table-sm" t-if="o.package_level_ids and o.picking_type_entire_packs and o.state in ['assigned', 'done']">
                                <thead>
                                    <tr>
                                        <th name="th_package">Package</th>
                                        <th name="th_pko_from" t-if="o.picking_type_id.code != 'incoming'" groups="stock.group_stock_multi_locations">From</th>
                                        <th name="th_pki_from" t-if="o.picking_type_id.code != 'outgoing'" groups="stock.group_stock_multi_locations">To</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="o.package_level_ids.sorted(key=lambda p: p.package_id.name)" t-as="package">
                                        <t t-set="package" t-value="package.with_context(picking_id=o.id)"/>
                                        <td name="td_pk_barcode">
                                            <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' % ('Code128', package.package_id.name, 600, 100)" style="width:300px;height:50px; margin-left: -50px;" alt="Barcode"/><br/>
                                        </td>
                                        <td t-if="o.picking_type_id.code != 'incoming'" groups="stock.group_stock_multi_locations">
                                            <span t-field="package.location_id"/>
                                        </td>
                                        <td t-if="o.picking_type_id.code != 'outgoing'" groups="stock.group_stock_multi_locations">
                                            <span t-field="package.location_dest_id"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <div>
                              <div class="text-right">Form No.: SPI123-3  </div>
                            </div>

                            <t t-set="no_reserved_product" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty != x.reserved_availability and x.move_line_ids and x.state!='done')"/>
                            <!--p t-if="o.state in ['draft', 'waiting', 'confirmed'] or no_reserved_product"><i class="fa fa-exclamation-triangle"/-->
                            <!--p t-if="o.state in ['draft', 'waiting', 'confirmed'] or no_reserved_product"><i class="fa fa-square-o"/>
                                All products could not be reserved. Click on the "Check Availability" button to try to reserve products.
                            </p-->
                            <p />
                        </div>
                        <!--div class="footer">
                          <div class="text-right">Form No.: SPI123-3  </div>
                        </div-->

                    </t>
                </t>
            </t>
        </template>
        <template id="report_picking_list_request_customization" inherit_id="report_picking_list_request">
          <!--xpath expr="/t[1]/t[1]/t[1]/t[1]/div[1]/table[1]/tbody[1]/t[1]/t[1]/tr[1]/td[2]/span[1]" position="attributes">
            <attribute name="t-field">ml.product_id.name</attribute>
          </xpath-->
          <xpath expr="/t/t/t/t/div/table[1]" position="after">
            <div class="row">
              <div class="col-6">
                <span>New Column</span>
              </div>
              <div class="col-6">
                <span>New Column</span>
              </div>
            </div>
          </xpath>
          <xpath expr="/t/t/t/t/div/div[4]/div[1]/span" position="replace">
            <span>       Người yêu cầu                                     Người xác nhận</span>
          </xpath>
          <xpath expr="/t/t/t/t/div/div[4]/div[2]/span" position="replace">
            <span>Người phê duyệt                                             Nhân viên kho</span>
          </xpath>
        </template>
    </data>
</odoo>
